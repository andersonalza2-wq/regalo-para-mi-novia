<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Minijuego 3: Puzzle Rom√°ntico</title>
  <style>
    body {
      margin: 0;
      background-color: #0d0d0d;
      color: #fff;
      font-family: 'Courier New', monospace;
      text-align: center;
    }
    h1 {
      margin-top: 30px;
      font-size: 28px;
    }
    #tablero {
      display: none; /* Por defecto, oculto hasta que se inicia */
      margin: 30px auto;
      width: 320px;
      display: grid;
      grid-template-columns: repeat(4, 70px);
      grid-gap: 10px;
      justify-content: center;
    }
    .carta {
      background-color: #00ffff;
      border-radius: 8px;
      font-size: 28px;
      cursor: pointer;
      padding: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 70px; /* Asegurar que todas las cartas tengan la misma altura */
      transition: background-color 0.2s ease;
    }
    .carta:hover {
        background-color: #00e0e0;
    }
    #ganaste, #regaloFinal, #mensajeFinal {
      display: none;
      margin-top: 30px;
    }
    button {
      background-color: #00ffcc;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
        background-color: #00cccc;
    }
    #volverMenuPrincipal {
        position: fixed;
        top: 15px;
        right: 15px;
        background: #ff66cc;
        color: white;
        padding: 8px 15px;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        font-size: 0.9em;
        transition: background-color 0.3s ease;
    }
    #volverMenuPrincipal:hover {
        background-color: #e0529e;
    }
    img {
      border-radius: 12px;
      max-width: 90%;
      box-shadow: 0 0 20px #ff66cc;
      margin-top: 20px;
    }
    /* Estilos para ocultar el bot√≥n de retroceder cuando no sea necesario */
    #volver.hidden {
        display: none;
    }
  </style>
</head>
<body>
  <audio id="backgroundMusic" loop>
      <source src="https://www.chosic.com/wp-content/uploads/2022/02/lofi-study-112191.mp3" type="audio/mpeg">
      Tu navegador no soporta el elemento de audio.
  </audio>

  <button id="volverMenuPrincipal" onclick="window.location.href='index.html'">üè° Men√∫ Principal</button>
  <button id="volver" onclick="retrocederPaso()" style="display:none;">‚è™ Retroceder</button>


  <h1>Minijuego 3: Puzzle Rom√°ntico üß©‚ù§Ô∏è</h1>

  <div id="tablero"></div>

  <div id="ganaste">
    <button onclick="mostrarRegaloFinal()">üéÅ Lo lograste, ver tu regalo</button>
  </div>

  <div id="regaloFinal">
    <h2>üéâ ¬°Tu √öltimo Regalo! üéâ</h2>
    <img src="https://i.imgur.com/QpaqNbx.jpeg" alt="Regalo final">
    <p>Gracias por completar esta aventura conmigo ‚ù§Ô∏è. Este es tu √∫ltimo regalo.</p>
    <button onclick="mostrarMensajeFinal()">üíå Ver tu Mensaje Final</button>
  </div>

  <div id="mensajeFinal">
    <h2>üéÅ ¬°Mensaje de Amor Especial! üéÅ</h2>
    <p>Mi amor, en este d√≠a tan especial,<br>
    tu luz brilla m√°s que el sol de verano.<br>
    Un a√±o m√°s de risas y de sue√±os,<br>
    de un amor que crece en cada plano.</p>

    <p>Tus ojos, dos luceros que me gu√≠an,<br>
    tu sonrisa, el regalo m√°s preciado.<br>
    En cada gesto, en cada melod√≠a,<br>
    mi coraz√≥n por ti est√° embelesado.</p>

    <p>Que la alegr√≠a inunde tu camino,<br>
    que cada anhelo se haga realidad.<br>
    Hoy celebro el regalo de tenerte,<br>
    mi amor, mi vida, mi felicidad.</p>

    <p>Feliz cumplea√±os, mi dulce amor,<br>
    que este d√≠a sea solo el comienzo<br>
    de mil momentos llenos de pasi√≥n<br>
    y un futuro eterno, sin tropiezos.</p>

    <p style="margin-top: 30px; font-weight: bold; color: #ff69b4;">¬°Te amo con todo mi coraz√≥n! ü•∞</p>
  </div>

  <script>
    // Script para que la m√∫sica intente sonar autom√°ticamente
    document.addEventListener('DOMContentLoaded', () => {
        const music = document.getElementById('backgroundMusic');
        music.volume = 0.5; // Ajusta el volumen
        music.play().catch(error => {
            console.log('Autoplay blocked. User interaction required for music.');
            // Si el autoplay falla, escucha el primer clic o interacci√≥n en la p√°gina
            document.addEventListener('click', () => {
                music.play().catch(e => console.log('Music play error on click:', e));
            }, { once: true });
            document.addEventListener('keydown', () => {
                music.play().catch(e => console.log('Music play error on keydown:', e));
            }, { once: true });
        });
    });


    const emojis = ['üíò','üòà','üéâ','üòò','üòç','üíò','üòà','üéâ','üòò','üòç','üåü','üåà','üåü','üåà','üöÄ','üöÄ']; // Ajustado para 16 elementos
    let mezcla = [...emojis].sort(() => Math.random() - 0.5);
    let tablero = document.getElementById("tablero");
    let seleccion = [];
    let cartas = [];
    let paresEncontrados = 0;
    const totalPares = emojis.length / 2; // Asegurarse que el total de pares es correcto

    const volverBtn = document.getElementById("volver");

    function crearTablero() {
      tablero.innerHTML = ''; // Limpiar tablero por si se reinicia
      cartas = []; // Limpiar array de cartas
      seleccion = [];
      paresEncontrados = 0;
      mezcla = [...emojis].sort(() => Math.random() - 0.5); // Mezclar de nuevo

      mezcla.forEach((emoji, i) => {
        let div = document.createElement("div");
        div.classList.add("carta");
        div.dataset.index = i;
        div.textContent = "‚ùì";
        div.onclick = () => voltear(i);
        tablero.appendChild(div);
        cartas.push(div);
      });
      tablero.style.display = "grid"; // Mostrar tablero al inicio
      document.getElementById("ganaste").style.display = "none";
      document.getElementById("regaloFinal").style.display = "none";
      document.getElementById("mensajeFinal").style.display = "none";
    }

    function voltear(i) {
      if (seleccion.length < 2 && cartas[i].textContent === "‚ùì") { // Asegurarse de no voltear cartas ya volteadas
        cartas[i].textContent = mezcla[i];
        seleccion.push(i);
        if (seleccion.length === 2) {
          setTimeout(verificar, 700); // Dar un poco m√°s de tiempo para ver las cartas
        }
      }
    }

    function verificar() {
      let [a, b] = seleccion;
      if (mezcla[a] === mezcla[b]) {
        cartas[a].style.visibility = "hidden";
        cartas[b].style.visibility = "hidden";
        paresEncontrados++;
        if (paresEncontrados === totalPares) {
          document.getElementById("ganaste").style.display = "block";
          tablero.style.display = "none"; // Ocultar el tablero al ganar
          volverBtn.style.display = "none"; // Ocultar bot√≥n retroceder al ganar
        }
      } else {
        cartas[a].textContent = "‚ùì";
        cartas[b].textContent = "‚ùì";
      }
      seleccion = [];
    }

    function mostrarRegaloFinal() {
      tablero.style.display = "none";
      document.getElementById("ganaste").style.display = "none";
      document.getElementById("regaloFinal").style.display = "block";
      volverBtn.style.display = "inline-block"; // Mostrar bot√≥n retroceder
    }

    function mostrarMensajeFinal() {
      document.getElementById("regaloFinal").style.display = "none";
      document.getElementById("mensajeFinal").style.display = "block";
      volverBtn.style.display = "inline-block"; // Mostrar bot√≥n retroceder
    }

    function retrocederPaso() {
      if (document.getElementById("mensajeFinal").style.display === "block") {
        document.getElementById("mensajeFinal").style.display = "none";
        document.getElementById("regaloFinal").style.display = "block";
      } else if (document.getElementById("regaloFinal").style.display === "block") {
        document.getElementById("regaloFinal").style.display = "none";
        // Si el tablero ya est√° oculto por ganar, no lo vuelvas a mostrar aqu√≠.
        // Asumiendo que volver√°s al estado de "ganaste" para poder volver a jugar si quiere.
        document.getElementById("ganaste").style.display = "block";
        volverBtn.style.display = "none"; // Ocultar retroceder si vuelves a la pantalla de ganar
      }
    }

    // Inicia juego autom√°ticamente al cargar la p√°gina
    window.onload = crearTablero;
  </script>
</body>
</html>